<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–∫—Ä–æ–π —Å–≤–æ–π –∫–µ–π—Å</title>
    <style>
        .case-button {
            display: inline-block;
            padding: 20px 40px;
            font-size: 24px;
            background-color: #008CBA;
            color: white;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .case-button:hover {
            background-color: #005f73;
        }
    </style>
</head>
<body>
    <h1>–û—Ç–∫—Ä–æ–π —Å–≤–æ–π –∫–µ–π—Å</h1>
    <button class="case-button" onclick="openCase()">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
        Telegram.WebApp.init();

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserData() {
            return Telegram.WebApp.initDataUnsafe;
        }

        // –í—ã–ø–æ–ª–Ω–∏–º GET-–∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        function fetchNgrokLink() {
            return fetch(`https://abc123.ngrok.io/get_ngrok_link`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => data.link);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function openCase() {
            // –ü–æ–ª—É—á–∞–µ–º user_id —á–µ—Ä–µ–∑ Telegram Web App SDK
            const userData = getUserData();
            const user_id = userData.user.id;  // –ü–æ–ª—É—á–∞–µ–º user_id

            fetchNgrokLink().then((url) => {
                const emojis = ["üíÄ", "üòé", "üéÆ", "üê±", "üöÄ", "üî•", "üçÄ", "‚ö°", "üí•"];  // –ú–∞—Å—Å–∏–≤ —ç–º–æ–¥–∑–∏
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                console.log(`–í—ã–ø–∞–ª–æ —ç–º–æ–¥–∑–∏: ${randomEmoji}`);

                // –û—Ç–ø—Ä–∞–≤–∏–º POST-–∑–∞–ø—Ä–æ—Å —Å —ç–º–æ–¥–∑–∏ –∏ user_id
                fetch(url + '/send_emoji', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: user_id,  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º user_id
                        emoji: randomEmoji
                    })
                })
                .then(response => response.json())
                .then(data => {
                    alert(`–í—ã–ø–∞–ª–æ —ç–º–æ–¥–∑–∏: ${randomEmoji}`);
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ POST –∑–∞–ø—Ä–æ—Å–∞:", error);
                });
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ ngrok URL:", error);
            });
        }
    </script>
</body>
</html>
